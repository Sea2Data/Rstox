# Rstox version: 1.9.1 (latest alpha, 2019-01-24)
# R version: 3.5.0

# The package Rstox contains most of the functionality of the stock assesment utility StoX, which is an open source approach to acoustic and swept area survey calculations. Download Rstox from ftp://ftp.imr.no/StoX/Download/Rstox or install by running the following commands in R:

# Install the packages that Rstox depends on. Note that this updates all the specified packages to the latest (binary) version:
dep.pck <- c("data.table", "ggplot2", "pbapply", "rgdal", "rgeos", "rJava", "sp", "XML")
install.packages(dep.pck, repos="http://cran.us.r-project.org", type="binary")

# Install Rstox:
install.packages("ftp://ftp.imr.no/StoX/Download/Rstox/Versions/Alpha/Rstox_1.9.1/Rstox_1.9.1.tar.gz", repos=NULL)

# Alternatively, install the latest development version from GitHub.
# Note that this does not guarantee a stable version.
# For official versions of Rstox, refer to the ftp server ftp://ftp.imr.no/StoX/Download/Rstox/Versions/Alpha/Rstox_1.9.1 as described above.
# Install from github using the devtools package:
# devtools::install_github("Sea2Data/Rstox", ref="develop")

# R should be installed as the 64 bit version. On Windows 10, ONLY the 64 bit version should be used.
# To do this, uncheck the box "32-bit Files" when selecting components to install.
# If you are re-installing an R that has both 32 and 64 bit, you will need to uninstall R first.

# On Windows systems with adminstrator requirements, it is recommended to install R in C:/users/<user>/documents/R.
# Also if you are using Rstudio, please make sure that you are using the correct R version (in case you have
# multiple versions installed). The R version can be selected in Tools > Global Options.

# Note that 64 bit Java is required to run Rstox

# On Windows, install Java from this webpage: https://www.java.com/en/download/windows-64bit.jsp,
# or follow the instructions found on ftp://ftp.imr.no/StoX/Tutorials/

# On Mac, getting Java and Rstox to communicate can be challenging.
# If you run into problems such as "Unsupported major.minor version ...", try the following:
# Update java, on
# 	http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html
# If this does not work install first the JDK and then the JRE:
# 	http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
# 	http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html
# Rstox sohuld also work with Java 11, presently available only as Development Kit:
# 	https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html
# You may want to check that the downloaded version is first in the list by running the following in the Terminal:
# 	/usr/libexec/java_home -V
# 	java -version
# Then run this in the Terminal.app (you will be asked for password, but the password will not show as you type.
# It is possible to type the password in a text editor first and then paste it into the Terminal.):
# 	sudo ln -s $(/usr/libexec/java_home)/jre/lib/server/libjvm.dylib /usr/local/lib
# 	sudo R CMD javareconf
# Open R (close and then open if already open) and install rJava:
# 	install.packages('rJava', type="binary")
# If this fails, try installing from source instead using install.packages('rJava', type='source')
# Then the installed Rstox should work.


# Release notes Rstox_1.9.1:

# 1. Added support for NMD API version 2 in getMNDinfo() and getNMDdata(). The output from getMNDinfo("platform") now coincides with that from getMNDinfo("v"), being a data frame with all entries of all platforms, where some platforms can have multiple entries. Before getMNDinfo("v") returned only the last entry of each platform.

# 2. Fixed bug in getNMDinfo("v"), where the returned data frame only contained NA.

# 3. Fixed bug in surveyPlanner(), where the output data frame 'Transect' contained stratum indices instead of stratum names.

# 4. Changed the output of getNMDinfo("taxa") to have one column per species, with the scientific, norwegian, english and russian name as columns, as well as a column OldNames for old (non-preffered) names, given as strings such as "Norwegian: r√∏dkrabbe, Scientific: Geryon tridens, English: red crab".

# 5. Fixed bug in plotStratum(), where transect=FLASE did not suppress plotting transects, whereas transect=NULL did. In the new version all values other than TRUE suppresses plotting transects.

# 6. Fixed bug in getNMDinfo("platform") and getNMDinfo("v"), where the columns validFrom and validTo did not correspond to the correct platform codes/names due to a sorting of these dates.

# 7. Fixed bug in getNMDinfo, where UTF-8 encoding was ineffective (the corresponding bugfix in Version 1.3.2 was discovered to be ineffective). 

# 8. Removed error in readStrataPolygons(), where multipolygons were not supported. Now only the first polygon of multipolygons are kept in the outputs 'lonlat' and 'lonlatAll', and all are kept in 'lonlatFull'.

# 9. Changed surveyPlanner() to discard strata with zero effort, but keep those strata in the Input list for plotting.

# 10. Added the parameter "JavaMem" in bootstrap functions, used for setting the Java memory of each bootstrap replicate (useful to reduce memory for parallelized bootstrapping).

# 11. Added the functions writeBioticXML() and writeAcousticXML() (with supporting functions), which takes a data frame as input and writes the data frame to an XML file given XML-schema (XSD) files shipped along with Rstox. The input data frame has one column per combination of variable and attribute, where the attributes are coded into the column names in the following manner: variableName..attributeName.attributeValue. If there are variables with identical names at different levels in the XMl hierarchy, the level (i.e., the name of the parent node) can be given in the column name by separation of a dot: variableName.level.

# 12. Removed LICENSE file, as this is unambigously stated in the DESCRIPTION file.

# 13. Changed from using 'formulardato' to using 'sistefangstdato' in baseline2eca().

# 14. Fixed bug in runBaseline(), where exportCSV==TRUE now implies resetting (and rerunning) the baseline.

# 15. Changed 'covariateLink' in the output from baseline2eca() to link to the union of the covariate values in biotic and landing (and not only to landing as before). Also changed name of the thrid column of the data frames in covariateDefinition from "Value" to "Definition".

# 16. Removed the covariate 'season', which was used in conjunction to 'year'. Now, these are concatinated in the temporal covariate.

# 17. Changed the name of baseline2eca() to getCovData(). The old function kept for backwards compatibility.

# 18. Removed the option 'quiet' in downloadXML(), which is replaced by 'msg'.

# 19. Added the option getMNDinfo("cruise") or getMNDinfo("cruises"), for returning a list of all cruises.

# 20. Avoided strange behavior by rgeos::readWKT() on Windows, where long strings were "unable to parse" (500 charaters).

# 21. Fixed bug in runBaseline(), where when reset=TRUE, and startProcess was a later process than the first process to be changed using parlist or ..., the baseline was not run from that first process, but from the specified startProcess. Using parlist or ... now forces running the baseline from the first necessary process. 

# 22. Cleaned up how startProcess and endProcess interacts with 'reset' and the unrun and changed processes. The documentation updated with the following: The parameters startProcess and endProcess specify the range of processes to run (startProcess : endProcess). If the model has been run already for all or some of the processes in this range, only the unrun processes are run. If there are processes in or prior to this range for which parameters have changed, all processes from the first changed process and throughout the range startProcess : endProcess are rerun. The range of processes to run is extended to any changed processes beyond the range. If reset=TRUE, the range or processes to run is extended to the range startProcess : endProcess regardless of whether the processes have previouslu been run.

# 23. Added the predefined values as attributes to the parameter values returned from getBaseline().

# 24. Added the function closeAllProjects().

# 25. Changed default of keepMissing to TRUE in readBaselineParametersJava(), thus including all parameters, even those which are not set when running getBaseline().

# 26. Increased default memory from 2 to 6 GB to accommodate ECA projects, which are generally large.

# 27. Renamed the parameter API to server in getNMDinfo() and getNMDdata(). No backwards compatibility.

# 28. Fixed bug with Java v11.

# 29. Fixed bug with subset in getNMDdata().



# For historical release notes see https://github.com/Sea2Data/Rstox/blob/alpha/NEWS
